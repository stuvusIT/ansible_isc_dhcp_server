# {{ ansible_managed }}

{% for option in isc_dhcp_server_config_ipv4 %}
{{ option }};
{% endfor %}

{% for subnet, options in isc_dhcp_server_subnets.items() %}
{% if subnet | ipv4 %}
subnet {{ subnet | ipaddr('network') }} netmask {{ subnet | ipaddr('netmask') }} {
{% if options | map('regex_search', '^range ') | select('string') | length == 0 %}
  range {{ subnet | ipaddr('100') | ipaddr('address') }} {{ subnet | ipaddr('-2') | ipaddr('address') }};
{% endif %}
{% if options | map('regex_search', '^option routers ') | select('string') | length == 0 %}
  option routers {{ subnet | ipaddr('address') }};
{% endif %}
{% for option in options %}
  {{ option }};
{% endfor %}
}
{% endif %}
{% endfor %}

{% for host, options in isc_dhcp_server_hosts.items() %}
host {{ host }} {
{% for option in options %}
{% if not option | regex_search('^fixed-address6 ') %}
  {{ option }};
{% endif %}
{% endfor %}
}
{% endfor %}
